# 쿠버네티스 리소스의 관리와 설정

- #### 네임스페이스

  리소스를 논리적으로 구분하기 위해 네임스페이스라는 오브젝트 제공. 

  네임스페이스는 **포드, 레플리카셋, 디플로이먼트, 서비스** 등과 같은 쿠버네티스 리소스들이 묶여 있는 하나의 가상 공간 또는 그룹

- #### 컨피그맵(Configmap)

  : 컨피그맵에서는 설정값 저장 

![configmap](https://user-images.githubusercontent.com/47243329/92077388-49dac300-edf7-11ea-8f72-68def35afef2.PNG)

  > Configmap 
  >
  > - envFrom : 컨피그맵에 존재하는 모든 키-값 쌍을 가져옴
  > - valueFrom과 configMapKeyRef : 컨피그맵에 존재하는 키-값 쌍 중에서 원하는 데이터만 선택적으로 가져옴

- ##### 컨피그맵의 내용을 파일로 포드 내부에 마운트하기

  애플리케이션이 특정 파일(ex. nginx.conf, mysql.conf)로부터 설정값을 읽어온다면 컨피그맵의 데이터를 포드 내부의 파일로 마운트해 사용 가능

  

- ##### 파일로부터 컨피그맵 생성하기

  설정 파일 내용의 정체를 컨피그맵에 저장한 뒤 이를 볼륨 파일로 포드 내부에 제공하는 관리 방법

  > --from-literal 옵션 대신에 --from-file 옵션을 사용
  >
  > kubectl create cofigmap [컨피그맵 이름] --from-file [파일이름]

  

- ##### YAML 파일로 컨피그맵 정의하기

  컨피그맵을 생성하지 않고 YAML 파일의 내용을 출력. 출력된 내용을 YAML 파일로 사용하면 컨피그맵 또한 YAML 파일로 배포해서 사용 가능



- #### 시크릿(Secret)

  : 시크릿에는 노출되어서는 안 되는 비밀값을 저장, 키-값 쌍에서 값에 해당하는 부분이 base64로 값을 인코딩하여 저장

  컨피크맵과 같이 우선 시크릿을 생성 후 secretKeyRef에 key-value를 작성하여 적용

  `상세 정보 조회 : kubectl get secret my-password -o yaml`



  ##### 이미지 레지스트리 접근을 위한 docker-registry 타입의 시크릿 사용하기

  > Opaque 타입 : 여러분이 별도로 시크릿의 종류를 명시하지 않으면 자동으로 설정되는 타입으로, 사용자가 정의하는 데이터를 저장할 수 있는 일만적인 목적의 시크릿

  사설 레지스트리, 도커 허브, GCR, ECR등의 클라우드 레지스트리를 사용하고 있다면 인증 절차가 필요.

  쿠버네티스는 docker login과 같은 명령어 대신 레지스트리의 인증 정보를 저장하는 별도의 시크릿을 생성해 사용하고, 방법에는 **자동으로 생성하는 파일을 사용하는 것** **시크릿을 생성하는 명령어에서 직접 로그인 인증 정보를 명시**하는 것이 있다.

  

  ##### TLS키를 저장할 수 있는 tls 타입의 시크릿 사용하기

  시크릿은 TLS 연결에 사용되는 공개키, 비밀키 등을 쿠버네티스 자체적으로 저장할 수 있도록 tls 타입 지원. 따라서 포드 내부의 애플리케이션이 보안 연결을 위해 인증서나 비밀키 등을 가져와야 할 때 **시크릿의 값을 포드에 제공하는 방식**으로 사용.

  

  ##### 컨피그맵과 시크릿 리소스 배포하기

  이 전과 같이 kubectl create secret 명령어를 사용한다면 YAML 파일로 배포하기 위해 시크릿의 데이터를 YAML 파일과 함께 저장해 둬야 한다. 

  ##### kustomize 기능 

  시크릿의 데이터가 점점 많아질수록 YAML 파일에 직접 시크릿 데이터를 저장하는 것은 데이터 관리나 가독성 측면에서 어려움이 있어, 시크릿이나 컨피그맵을 배포하기 위해 YAML 파일을 작성할 때 **데이터를 YAML 파일로부터 분리**하기 위한 기능

  => YAML 파일의 속성을 별도로 정의해 재사용하거나 여러 YAML 파일을 하나로 묶는 등 다양한 용도로 사용 가능

  

  ##### 컨피그맵이나 시크릿을 업데이트해 애플리케이션의 설정값 변경하기

  1. `kubectl edit`

  2. YAML파일 변경 후 `kubectl apply`

  3. `kubectl patch`

  

  

  
